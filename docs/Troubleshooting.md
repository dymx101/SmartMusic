# 故障排除指南

## 常见问题

### 1. 播放问题
#### 无法播放音乐
- 检查网络连接
- 确认音频URL是否有效
- 检查音频格式是否支持

#### 后台播放失效
- 确认 Info.plist 中的后台播放权限
- 检查 AudioSession 配置
- 验证锁屏控制是否正确设置

### 2. 数据存储问题
#### SwiftData 错误
- 检查模型定义是否正确
- 验证关系配置
- 确认数据迁移设置

#### 持久化失败
- 检查存储权限
- 验证数据模型版本
- 确认存储路径

### 3. 性能问题
#### 内存占用过高
- 检查图片缓存
- 优化列表渲染
- 处理内存泄漏

#### 启动时间过长
- 优化初始化流程
- 延迟加载非关键组件
- 检查网络请求时序

## 调试技巧

### 1. 日志记录
```swift
func log(_ message: String, level: LogLevel = .info) {
    #if DEBUG
    print("[\(level.rawValue)] \(message)")
    #endif
}
```

### 2. 网络调试
- 使用 Charles 抓包
- 检查请求响应
- 验证数据格式

### 3. 性能分析
- 使用 Instruments 工具
- 检查内存泄漏
- 分析 CPU 使用

## 错误代码说明

### 网络错误
- 1001: 网络连接失败
- 1002: 服务器响应超时
- 1003: 数据解析错误

### 播放错误
- 2001: 音频格式不支持
- 2002: 播放初始化失败
- 2003: 音频流错误

### 数据错误
- 3001: 存储访问失败
- 3002: 数据模型不匹配
- 3003: 迁移失败
